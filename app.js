// Application data with comprehensive creator information
const appData = {
  "creators": [
    {
      "id": 1,
      "name": "ReanThort",
      "handle": "@reanthort",
      "email": "reanthort@example.com",
      "followers": 159000,
      "followerTrend": "+5.2%",
      "categories": ["Technology", "Entertainment"],
      "level": "News Master",
      "xp": 2800,
      "badges": ["First Steps", "Category Explorer", "News Master", "Rising Star"],
      "posts": 45,
      "engagement": 12.5,
      "referrals": 3,
      "premiumCreator": true,
      "onboardingDate": "2025-06-15",
      "lastActive": "2025-06-29",
      "profilePicture": null,
      "incentives": {
        "earlyLaunchPosts": 12,
        "earlyLaunchEarnings": 90,
        "referralCount": 3,
        "referralEarnings": 30,
        "projectedAdRevenue": 120,
        "projectedSubRevenue": 125,
        "totalProjectedMonthly": 335
      }
    },
    {
      "id": 2,
      "name": "Rising Giants",
      "handle": "@risinggiants",
      "email": "contact@risinggiants.com",
      "followers": 50000,
      "followerTrend": "+12.1%",
      "categories": ["Business"],
      "level": "Influencer",
      "xp": 1600,
      "badges": ["First Steps", "Category Explorer", "Community Builder"],
      "posts": 32,
      "engagement": 8.9,
      "referrals": 5,
      "premiumCreator": true,
      "onboardingDate": "2025-06-20",
      "lastActive": "2025-06-30",
      "profilePicture": null,
      "incentives": {
        "earlyLaunchPosts": 8,
        "earlyLaunchEarnings": 64,
        "referralCount": 5,
        "referralEarnings": 50,
        "projectedAdRevenue": 60,
        "projectedSubRevenue": 50,
        "totalProjectedMonthly": 224
      }
    },
    {
      "id": 3,
      "name": "Dr. Tong",
      "handle": "@drtong",
      "email": "drtong@health.com",
      "followers": 25000,
      "followerTrend": "+15.3%",
      "categories": ["Health"],
      "level": "Creator",
      "xp": 1100,
      "badges": ["First Steps", "Category Explorer", "Engagement King"],
      "posts": 28,
      "engagement": 15.2,
      "referrals": 1,
      "premiumCreator": true,
      "onboardingDate": "2025-06-25",
      "lastActive": "2025-06-29",
      "profilePicture": null,
      "incentives": {
        "earlyLaunchPosts": 6,
        "earlyLaunchEarnings": 56,
        "referralCount": 1,
        "referralEarnings": 10,
        "projectedAdRevenue": 30,
        "projectedSubRevenue": 35,
        "totalProjectedMonthly": 131
      }
    },
    {
      "id": 4,
      "name": "Coach Ratanak",
      "handle": "@coachratanak",
      "email": "coach@ratanak.com",
      "followers": 18000,
      "followerTrend": "+6.4%",
      "categories": ["Sports", "Health"],
      "level": "Creator",
      "xp": 950,
      "badges": ["First Steps", "Category Explorer"],
      "posts": 22,
      "engagement": 11.8,
      "referrals": 2,
      "premiumCreator": true,
      "onboardingDate": "2025-06-28",
      "lastActive": "2025-06-30",
      "profilePicture": null,
      "incentives": {
        "earlyLaunchPosts": 3,
        "earlyLaunchEarnings": 44,
        "referralCount": 2,
        "referralEarnings": 20,
        "projectedAdRevenue": 25,
        "projectedSubRevenue": 28,
        "totalProjectedMonthly": 117
      }
    },
    {
      "id": 5,
      "name": "IsMeHeng",
      "handle": "@ismeheng",
      "email": "ismeheng@content.com",
      "followers": 30000,
      "followerTrend": "+8.7%",
      "categories": ["Entertainment"],
      "level": "Influencer",
      "xp": 1400,
      "badges": ["First Steps", "Category Explorer", "Rising Star"],
      "posts": 38,
      "engagement": 9.6,
      "referrals": 1,
      "premiumCreator": true,
      "onboardingDate": "2025-06-18",
      "lastActive": "2025-06-30",
      "profilePicture": null,
      "incentives": {
        "earlyLaunchPosts": 9,
        "earlyLaunchEarnings": 76,
        "referralCount": 1,
        "referralEarnings": 10,
        "projectedAdRevenue": 45,
        "projectedSubRevenue": 42,
        "totalProjectedMonthly": 173
      }
    },
    {
      "id": 6,
      "name": "Techietalks.kh",
      "handle": "@techietalkskh",
      "email": "info@techietalks.kh",
      "followers": 15000,
      "followerTrend": "+11.2%",
      "categories": ["Technology"],
      "level": "Creator",
      "xp": 800,
      "badges": ["First Steps", "Category Explorer"],
      "posts": 25,
      "engagement": 7.3,
      "referrals": 0,
      "premiumCreator": true,
      "onboardingDate": "2025-06-26",
      "lastActive": "2025-06-29",
      "profilePicture": null,
      "incentives": {
        "earlyLaunchPosts": 5,
        "earlyLaunchEarnings": 50,
        "referralCount": 0,
        "referralEarnings": 0,
        "projectedAdRevenue": 20,
        "projectedSubRevenue": 22,
        "totalProjectedMonthly": 92
      }
    },
    {
      "id": 7,
      "name": "Bubble Brief",
      "handle": "@bubblebrief",
      "email": "team@bubblebrief.com",
      "followers": 22000,
      "followerTrend": "+9.8%",
      "categories": ["News", "Politics"],
      "level": "Influencer",
      "xp": 1200,
      "badges": ["First Steps", "Category Explorer", "Community Builder"],
      "posts": 35,
      "engagement": 10.4,
      "referrals": 4,
      "premiumCreator": true,
      "onboardingDate": "2025-06-22",
      "lastActive": "2025-06-30",
      "profilePicture": null,
      "incentives": {
        "earlyLaunchPosts": 11,
        "earlyLaunchEarnings": 70,
        "referralCount": 4,
        "referralEarnings": 40,
        "projectedAdRevenue": 35,
        "projectedSubRevenue": 38,
        "totalProjectedMonthly": 183
      }
    },
    {
      "id": 8,
      "name": "Business Cambodia",
      "handle": "@businesscambodia",
      "email": "news@businesscambodia.com",
      "followers": 35000,
      "followerTrend": "+7.3%",
      "categories": ["Business", "Politics"],
      "level": "Influencer",
      "xp": 1500,
      "badges": ["First Steps", "Category Explorer", "News Master"],
      "posts": 40,
      "engagement": 8.1,
      "referrals": 2,
      "premiumCreator": true,
      "onboardingDate": "2025-06-19",
      "lastActive": "2025-06-30",
      "profilePicture": null,
      "incentives": {
        "earlyLaunchPosts": 7,
        "earlyLaunchEarnings": 80,
        "referralCount": 2,
        "referralEarnings": 20,
        "projectedAdRevenue": 50,
        "projectedSubRevenue": 48,
        "totalProjectedMonthly": 198
      }
    }
  ],
  "incentivePrograms": {
    "revenueShare": {
      "percentage": 50,
      "duration": 12,
      "eligibleCreators": 20,
      "currentCount": 8
    },
    "earlyLaunch": {
      "payPerPost": 2,
      "startDate": "2025-07-24",
      "endDate": "2025-10-24",
      "daysRemaining": 24
    },
    "referralBonus": {
      "bonusAmount": 10,
      "minimumPosts": 3,
      "duration": 6,
      "monthsRemaining": 5.5
    }
  },
  "categories": ["Politics", "Sports", "Health", "Business", "Technology", "Entertainment", "News"],
  "badges": [
    {"name": "First Steps", "description": "Complete profile setup", "color": "#4CAF50", "icon": "‚úÖ"},
    {"name": "Category Explorer", "description": "Post in 3+ categories", "color": "#2196F3", "icon": "üóÇÔ∏è"},
    {"name": "News Master", "description": "Post in all 6 categories", "color": "#FF9800", "icon": "üëë"},
    {"name": "Community Builder", "description": "Refer 3+ creators", "color": "#9C27B0", "icon": "ü§ù"},
    {"name": "Rising Star", "description": "Reach 10k+ followers", "color": "#F44336", "icon": "‚≠ê"},
    {"name": "Engagement King", "description": "Achieve 10%+ engagement", "color": "#FFD700", "icon": "üèÜ"}
  ],
  "missions": [
    {"name": "Welcome Aboard", "description": "Complete your profile", "xp": 100, "difficulty": "Beginner", "icon": "üéØ"},
    {"name": "First Post", "description": "Publish your first video", "xp": 150, "difficulty": "Beginner", "icon": "üìπ"},
    {"name": "Category Explorer", "description": "Post in 3 different categories", "xp": 300, "difficulty": "Intermediate", "icon": "üóÇÔ∏è"},
    {"name": "Community Builder", "description": "Refer 3 new creators", "xp": 500, "difficulty": "Advanced", "icon": "ü§ù"},
    {"name": "Engagement Master", "description": "Achieve 10% engagement rate", "xp": 400, "difficulty": "Intermediate", "icon": "üèÜ"},
    {"name": "News Master", "description": "Post in all 6 categories", "xp": 750, "difficulty": "Advanced", "icon": "üëë"}
  ]
};

// Global variables
let currentTab = 'dashboard';
let filteredCreators = [...appData.creators];
let creatorToDelete = null;
let logoImageSrc = null;

// Chart colors as specified
const chartColors = ['#1FB8CD', '#FFC185', '#B4413C', '#ECEBD5', '#5D878F', '#DB4545', '#D2BA4C', '#964325', '#944454', '#13343B'];

// Initialize app when DOM is loaded and Chart.js is available
document.addEventListener('DOMContentLoaded', function() {
  if (typeof Chart !== 'undefined') {
    initializeApp();
  } else {
    console.error('Chart.js not loaded properly');
    // Try to initialize anyway
    setTimeout(initializeApp, 500);
  }
});

function initializeApp() {
  setupEventListeners();
  setupLogoUpload();
  updateHeaderStats();
  renderDashboard();
  renderCreatorsTable();
  renderIncentivesTab();
  renderAnalyticsTab();
  renderCategoryMatrix();
  renderLeaderboard();
  renderMissions();
  setupEarningsCalculator();
}

function setupLogoUpload() {
  const logoUploadBtn = document.getElementById('logoUploadBtn');
  const logoFileInput = document.getElementById('logoFileInput');
  const logoFallback = document.getElementById('logoFallback');
  const logoImg = document.getElementById('logoImg');

  if (!logoUploadBtn || !logoFileInput) return;

  logoUploadBtn.addEventListener('click', function(e) {
    e.preventDefault();
    logoFileInput.click();
  });

  logoFileInput.addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
      handleLogoUpload(file);
    }
  });
}

function handleLogoUpload(file) {
  if (!file.type.startsWith('image/')) {
    showToast('Please upload a valid image file (PNG or JPEG).', 'error');
    return;
  }

  if (file.size > 2 * 1024 * 1024) {
    showToast('Image size must be less than 2MB.', 'error');
    return;
  }

  const reader = new FileReader();
  reader.onload = function(e) {
    logoImageSrc = e.target.result;
    updateLogoDisplay();
    showToast('Logo uploaded successfully!', 'success');
  };
  reader.readAsDataURL(file);
}

function updateLogoDisplay() {
  const logoFallback = document.getElementById('logoFallback');
  const logoImg = document.getElementById('logoImg');

  if (logoImageSrc && logoImg && logoFallback) {
    logoImg.src = logoImageSrc;
    logoImg.style.display = 'block';
    logoFallback.style.display = 'none';
  }
}

function setupEventListeners() {
  document.querySelectorAll('.nav__tab').forEach(tab => {
    tab.addEventListener('click', function() {
      switchTab(this.dataset.tab);
    });
  });

  const creatorSearch = document.getElementById('creatorSearch');
  if (creatorSearch) {
    creatorSearch.addEventListener('input', function() {
      filterCreators(this.value);
    });
  }

  const leaderboardType = document.getElementById('leaderboardType');
  if (leaderboardType) {
    leaderboardType.addEventListener('change', function() {
      renderLeaderboard(this.value);
    });
  }

  setupModalEvents();

  const addCreatorForm = document.getElementById('addCreatorForm');
  const editCreatorForm = document.getElementById('editCreatorForm');
  const calculateEarnings = document.getElementById('calculateEarnings');

  if (addCreatorForm) addCreatorForm.addEventListener('submit', handleAddCreator);
  if (editCreatorForm) editCreatorForm.addEventListener('submit', handleEditCreator);
  if (calculateEarnings) calculateEarnings.addEventListener('click', calculateEarnings);
}

function setupModalEvents() {
  const modalEvents = [
    { id: 'closeCreatorModal', action: () => closeModal('creatorModal') },
    { id: 'addCreatorBtn', action: () => {
      openModal('addCreatorModal');
      populateCategoryCheckboxes();
      resetProfilePicture('add');
      setTimeout(() => setupProfilePictureUpload('add'), 100);
    }},
    { id: 'closeAddCreatorModal', action: () => closeModal('addCreatorModal') },
    { id: 'cancelAddCreator', action: () => closeModal('addCreatorModal') },
    { id: 'closeEditCreatorModal', action: () => closeModal('editCreatorModal') },
    { id: 'cancelEditCreator', action: () => closeModal('editCreatorModal') },
    { id: 'closeDeleteCreatorModal', action: () => closeModal('deleteCreatorModal') },
    { id: 'cancelDeleteCreator', action: () => closeModal('deleteCreatorModal') },
    { id: 'confirmDeleteCreator', action: handleDeleteCreator }
  ];

  modalEvents.forEach(event => {
    const element = document.getElementById(event.id);
    if (element) {
      element.addEventListener('click', event.action);
    }
  });

  document.querySelectorAll('.modal__backdrop').forEach(backdrop => {
    backdrop.addEventListener('click', function() {
      const modal = this.closest('.modal');
      if (modal) closeModal(modal.id);
    });
  });
}

function setupProfilePictureUpload(prefix) {
  const fileInput = document.getElementById(`${prefix}ProfilePicture`);
  const dropzone = document.getElementById(`${prefix}Dropzone`);
  const removeBtn = document.getElementById(`remove${prefix.charAt(0).toUpperCase() + prefix.slice(1)}Photo`);
  
  if (!fileInput || !dropzone || !removeBtn) return;

  function handleFileInputChange(e) {
    if (e.target.files && e.target.files[0]) {
      handleImageUpload(e.target.files[0], prefix);
    }
  }

  function handleDropzoneClick(e) {
    e.preventDefault();
    fileInput.click();
  }

  function handleDragOver(e) {
    e.preventDefault();
    dropzone.classList.add('dragover');
  }

  function handleDragLeave(e) {
    e.preventDefault();
    dropzone.classList.remove('dragover');
  }

  function handleDrop(e) {
    e.preventDefault();
    dropzone.classList.remove('dragover');
    
    if (e.dataTransfer.files && e.dataTransfer.files[0]) {
      const file = e.dataTransfer.files[0];
      if (file.type.startsWith('image/')) {
        handleImageUpload(file, prefix);
      } else {
        showToast('Please upload a valid image file.', 'error');
      }
    }
  }

  function handleRemoveClick(e) {
    e.preventDefault();
    removeProfilePicture(prefix);
  }

  fileInput.addEventListener('change', handleFileInputChange);
  dropzone.addEventListener('click', handleDropzoneClick);
  dropzone.addEventListener('dragover', handleDragOver);
  dropzone.addEventListener('dragleave', handleDragLeave);
  dropzone.addEventListener('drop', handleDrop);
  removeBtn.addEventListener('click', handleRemoveClick);
}

function handleImageUpload(file, prefix) {
  if (file.size > 5 * 1024 * 1024) {
    showToast('Image size must be less than 5MB.', 'error');
    return;
  }

  if (!file.type.startsWith('image/')) {
    showToast('Please upload a valid image file.', 'error');
    return;
  }

  const reader = new FileReader();
  reader.onload = function(e) {
    displayProfilePicture(e.target.result, prefix);
    showToast('Profile picture uploaded successfully!', 'success');
  };
  reader.readAsDataURL(file);
}

function displayProfilePicture(imageSrc, prefix) {
  const preview = document.getElementById(`${prefix}ProfilePreview`);
  const removeBtn = document.getElementById(`remove${prefix.charAt(0).toUpperCase() + prefix.slice(1)}Photo`);
  
  if (!preview || !removeBtn) return;
  
  preview.innerHTML = `<img src="${imageSrc}" alt="Profile Picture" />`;
  removeBtn.style.display = 'inline-flex';
  preview.dataset.imageSrc = imageSrc;
}

function removeProfilePicture(prefix) {
  const preview = document.getElementById(`${prefix}ProfilePreview`);
  const removeBtn = document.getElementById(`remove${prefix.charAt(0).toUpperCase() + prefix.slice(1)}Photo`);
  const fileInput = document.getElementById(`${prefix}ProfilePicture`);
  
  if (!preview || !removeBtn || !fileInput) return;
  
  preview.innerHTML = `
    <div class="profile-placeholder">
      <i class="fa-solid fa-camera"></i>
      <p>Upload Photo</p>
    </div>
  `;
  removeBtn.style.display = 'none';
  fileInput.value = '';
  delete preview.dataset.imageSrc;
}

function resetProfilePicture(prefix) {
  removeProfilePicture(prefix);
}

function switchTab(tabName) {
  document.querySelectorAll('.nav__tab').forEach(tab => {
    tab.classList.remove('nav__tab--active');
  });
  document.querySelector(`[data-tab="${tabName}"]`).classList.add('nav__tab--active');

  document.querySelectorAll('.tab-content').forEach(content => {
    content.classList.remove('tab-content--active');
  });
  
  const targetTab = document.getElementById(tabName);
  if (targetTab) {
    targetTab.classList.add('tab-content--active');
  }

  currentTab = tabName;
}

function updateHeaderStats() {
  const totalCreators = appData.creators.length;
  const totalFollowers = appData.creators.reduce((sum, creator) => sum + creator.followers, 0);
  const avgEngagement = appData.creators.reduce((sum, creator) => sum + creator.engagement, 0) / appData.creators.length;
  const totalPosts = appData.creators.reduce((sum, creator) => sum + creator.posts, 0);
  const totalIncentivesPaid = appData.creators.reduce((sum, creator) => sum + creator.incentives.earlyLaunchEarnings + creator.incentives.referralEarnings, 0);

  const elements = {
    'totalCreators': totalCreators,
    'totalFollowers': formatNumber(totalFollowers),
    'avgEngagement': `${avgEngagement.toFixed(1)}%`,
    'totalPosts': totalPosts,
    'totalIncentivesPaid': `$${totalIncentivesPaid}`
  };

  Object.entries(elements).forEach(([id, value]) => {
    const element = document.getElementById(id);
    if (element) element.textContent = value;
  });
}

function renderDashboard() {
  const activityFeed = document.getElementById('activityFeed');
  if (activityFeed) {
    const activities = [
      { icon: 'üí∞', text: 'ReanThort earned $90 from early launch incentive', time: '2 hours ago' },
      { icon: 'ü§ù', text: 'Rising Giants received $50 referral bonus', time: '5 hours ago' },
      { icon: 'üìà', text: 'Dr. Tong projected to earn $131/month', time: '1 day ago' },
      { icon: 'üéØ', text: 'Bubble Brief completed 11 incentive posts', time: '2 days ago' },
      { icon: '‚≠ê', text: 'Coach Ratanak joined revenue share program', time: '3 days ago' }
    ];

    activityFeed.innerHTML = activities.map(activity => `
      <div class="activity-item">
        <div class="activity-icon">${activity.icon}</div>
        <div class="activity-content">
          <p class="activity-text">${activity.text}</p>
          <p class="activity-time">${activity.time}</p>
        </div>
      </div>
    `).join('');
  }

  createProgressChart();
  createPlatformOverviewChart();
}

function createProgressChart() {
  const canvas = document.getElementById('progressChart');
  if (!canvas || typeof Chart === 'undefined') return;

  const ctx = canvas.getContext('2d');
  
  const missionData = appData.creators.map(creator => {
    let progress = 0;
    if (creator.badges.includes('First Steps')) progress += 20;
    if (creator.badges.includes('Category Explorer')) progress += 20;
    if (creator.badges.includes('Rising Star')) progress += 25;
    if (creator.badges.includes('Community Builder')) progress += 15;
    if (creator.badges.includes('News Master')) progress += 20;
    return Math.min(progress, 100);
  });
  
  try {
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: appData.creators.map(creator => creator.name),
        datasets: [{
          label: 'Mission Progress (%)',
          data: missionData,
          backgroundColor: chartColors[0],
          borderColor: chartColors[0],
          borderWidth: 2,
          borderRadius: 8
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            labels: {
              color: '#ffffff'
            }
          }
        },
        scales: {
          x: {
            ticks: {
              color: '#81d4fa',
              maxRotation: 45
            },
            grid: {
              color: 'rgba(129, 212, 250, 0.1)'
            }
          },
          y: {
            beginAtZero: true,
            max: 100,
            ticks: {
              color: '#81d4fa'
            },
            grid: {
              color: 'rgba(129, 212, 250, 0.1)'
            }
          }
        }
      }
    });
  } catch (error) {
    console.error('Error creating progress chart:', error);
  }
}

function createPlatformOverviewChart() {
  const canvas = document.getElementById('platformOverviewChart');
  if (!canvas || typeof Chart === 'undefined') return;

  const ctx = canvas.getContext('2d');
  
  const totalFollowers = appData.creators.reduce((sum, creator) => sum + creator.followers, 0);
  const totalPosts = appData.creators.reduce((sum, creator) => sum + creator.posts, 0);
  const totalReferrals = appData.creators.reduce((sum, creator) => sum + creator.referrals, 0);
  
  try {
    new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['Total Followers', 'Total Posts', 'Total Referrals', 'Categories Covered'],
        datasets: [{
          data: [totalFollowers / 1000, totalPosts, totalReferrals, appData.categories.length],
          backgroundColor: [chartColors[0], chartColors[1], chartColors[2], chartColors[3]],
          borderColor: '#1a2332',
          borderWidth: 2
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            labels: {
              color: '#ffffff'
            }
          }
        }
      }
    });
  } catch (error) {
    console.error('Error creating platform overview chart:', error);
  }
}

function getCreatorAvatar(creator) {
  if (creator.profilePicture) {
    return `<img src="${creator.profilePicture}" alt="${creator.name}" />`;
  } else {
    return creator.name.charAt(0);
  }
}

function renderCreatorsTable() {
  const tbody = document.getElementById('creatorsTableBody');
  if (!tbody) return;
  
  tbody.innerHTML = filteredCreators.map(creator => `
    <tr>
      <td>
        <div class="creator-info">
          <div class="creator-avatar">
            ${getCreatorAvatar(creator)}
          </div>
          <div class="creator-details">
            <h4>${creator.name}</h4>
            <div class="creator-handle">${creator.handle}</div>
          </div>
        </div>
      </td>
      <td>
        <div class="follower-count">${formatNumber(creator.followers)}</div>
        <span class="follower-trend follower-trend--up">${creator.followerTrend}</span>
      </td>
      <td>
        <div class="incentive-earnings">$${creator.incentives.earlyLaunchEarnings}</div>
        <small>${creator.incentives.earlyLaunchPosts} posts</small>
      </td>
      <td>
        <div class="incentive-earnings">$${creator.incentives.referralEarnings}</div>
        <small>${creator.incentives.referralCount} referrals</small>
      </td>
      <td>
        <div class="revenue-projection">$${creator.incentives.totalProjectedMonthly}</div>
        <small>projected</small>
      </td>
      <td>
        <div class="categories-tags">
          ${creator.categories.map(cat => `<span class="category-tag">${cat}</span>`).join('')}
        </div>
      </td>
      <td>
        <span class="level-badge level-${creator.level.toLowerCase().replace(' ', '.')}">${creator.level}</span>
      </td>
      <td>
        <div class="action-buttons">
          <button class="btn btn--sm btn--outline" onclick="viewCreatorDetails(${creator.id})">
            <i class="fa-solid fa-eye"></i> View
          </button>
          <button class="btn btn--sm btn--secondary" onclick="editCreator(${creator.id})">
            <i class="fa-solid fa-edit"></i> Edit
          </button>
          <button class="btn btn--sm btn--error" onclick="confirmDeleteCreator(${creator.id})">
            <i class="fa-solid fa-trash"></i> Delete
          </button>
        </div>
      </td>
    </tr>
  `).join('');
}

function renderIncentivesTab() {
  createEarlyLaunchChart();
  createReferralChart();
  renderIncentiveSummary();
}

function createEarlyLaunchChart() {
  const canvas = document.getElementById('earlyLaunchChart');
  if (!canvas || typeof Chart === 'undefined') return;

  const ctx = canvas.getContext('2d');
  
  try {
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: appData.creators.map(creator => creator.name),
        datasets: [{
          label: 'Posts',
          data: appData.creators.map(creator => creator.incentives.earlyLaunchPosts),
          backgroundColor: chartColors[0],
          borderColor: chartColors[0],
          borderWidth: 2,
          borderRadius: 8,
          yAxisID: 'y'
        }, {
          label: 'Earnings ($)',
          data: appData.creators.map(creator => creator.incentives.earlyLaunchEarnings),
          backgroundColor: chartColors[1],
          borderColor: chartColors[1],
          borderWidth: 2,
          borderRadius: 8,
          yAxisID: 'y1'
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            labels: {
              color: '#ffffff'
            }
          }
        },
        scales: {
          x: {
            ticks: {
              color: '#81d4fa',
              maxRotation: 45
            },
            grid: {
              color: 'rgba(129, 212, 250, 0.1)'
            }
          },
          y: {
            type: 'linear',
            display: true,
            position: 'left',
            beginAtZero: true,
            ticks: {
              color: '#81d4fa'
            },
            grid: {
              color: 'rgba(129, 212, 250, 0.1)'
            }
          },
          y1: {
            type: 'linear',
            display: true,
            position: 'right',
            beginAtZero: true,
            ticks: {
              color: '#81d4fa'
            },
            grid: {
              drawOnChartArea: false
            }
          }
        }
      }
    });
  } catch (error) {
    console.error('Error creating early launch chart:', error);
  }
}

function createReferralChart() {
  const canvas = document.getElementById('referralChart');
  if (!canvas || typeof Chart === 'undefined') return;

  const ctx = canvas.getContext('2d');
  
  try {
    new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: appData.creators.map(creator => creator.name),
        datasets: [{
          data: appData.creators.map(creator => creator.incentives.referralCount),
          backgroundColor: chartColors.slice(0, appData.creators.length),
          borderColor: '#1a2332',
          borderWidth: 2
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            labels: {
              color: '#ffffff'
            }
          }
        }
      }
    });
  } catch (error) {
    console.error('Error creating referral chart:', error);
  }
}

function renderIncentiveSummary() {
  const summaryContainer = document.getElementById('incentiveSummary');
  if (!summaryContainer) return;
  
  const totalEarlyLaunchEarnings = appData.creators.reduce((sum, creator) => sum + creator.incentives.earlyLaunchEarnings, 0);
  const totalReferralEarnings = appData.creators.reduce((sum, creator) => sum + creator.incentives.referralEarnings, 0);
  const totalProjectedRevenue = appData.creators.reduce((sum, creator) => sum + creator.incentives.totalProjectedMonthly, 0);
  const totalPosts = appData.creators.reduce((sum, creator) => sum + creator.incentives.earlyLaunchPosts, 0);
  const totalReferrals = appData.creators.reduce((sum, creator) => sum + creator.incentives.referralCount, 0);
  
  summaryContainer.innerHTML = `
    <div class="earnings-breakdown">
      <div class="earnings-item">
        <span>Total Early Launch Earnings:</span>
        <span>$${totalEarlyLaunchEarnings}</span>
      </div>
      <div class="earnings-item">
        <span>Total Referral Earnings:</span>
        <span>$${totalReferralEarnings}</span>
      </div>
      <div class="earnings-item">
        <span>Total Incentive Posts:</span>
        <span>${totalPosts}</span>
      </div>
      <div class="earnings-item">
        <span>Total Referrals:</span>
        <span>${totalReferrals}</span>
      </div>
      <div class="earnings-total">
        <span>Projected Monthly Revenue:</span>
        <span>$${totalProjectedRevenue}</span>
      </div>
    </div>
  `;
}

function renderAnalyticsTab() {
  createRevenueDistributionChart();
  createRevenueGrowthChart();
  createCategoryPerformanceChart();
  createEngagementMetricsChart();
}

function createRevenueDistributionChart() {
  const canvas = document.getElementById('revenueDistributionChart');
  if (!canvas || typeof Chart === 'undefined') return;

  const ctx = canvas.getContext('2d');
  
  try {
    new Chart(ctx, {
      type: 'pie',
      data: {
        labels: appData.creators.map(creator => creator.name),
        datasets: [{
          data: appData.creators.map(creator => creator.incentives.totalProjectedMonthly),
          backgroundColor: chartColors.slice(0, appData.creators.length),
          borderColor: '#1a2332',
          borderWidth: 2
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            labels: {
              color: '#ffffff'
            }
          }
        }
      }
    });
  } catch (error) {
    console.error('Error creating revenue distribution chart:', error);
  }
}

function createRevenueGrowthChart() {
  const canvas = document.getElementById('revenueGrowthChart');
  if (!canvas || typeof Chart === 'undefined') return;

  const ctx = canvas.getContext('2d');
  
  try {
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
        datasets: [{
          label: 'Projected Revenue Growth',
          data: [800, 1200, 1485, 1650, 1820, 2100],
          borderColor: '#2196f3',
          backgroundColor: 'rgba(33, 150, 243, 0.1)',
          tension: 0.4,
          fill: true,
          borderWidth: 3
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            labels: {
              color: '#ffffff'
            }
          }
        },
        scales: {
          x: {
            ticks: {
              color: '#81d4fa'
            },
            grid: {
              color: 'rgba(129, 212, 250, 0.1)'
            }
          },
          y: {
            beginAtZero: true,
            ticks: {
              color: '#81d4fa'
            },
            grid: {
              color: 'rgba(129, 212, 250, 0.1)'
            }
          }
        }
      }
    });
  } catch (error) {
    console.error('Error creating revenue growth chart:', error);
  }
}

function createCategoryPerformanceChart() {
  const canvas = document.getElementById('categoryPerformanceChart');
  if (!canvas || typeof Chart === 'undefined') return;

  const ctx = canvas.getContext('2d');
  
  const categoryData = appData.categories.map(category => {
    const activeCreators = appData.creators.filter(creator => 
      creator.categories.includes(category)
    ).length;
    return activeCreators;
  });
  
  try {
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: appData.categories,
        datasets: [{
          label: 'Active Creators',
          data: categoryData,
          backgroundColor: chartColors.slice(0, appData.categories.length),
          borderColor: chartColors.slice(0, appData.categories.length),
          borderWidth: 2,
          borderRadius: 8
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            labels: {
              color: '#ffffff'
            }
          }
        },
        scales: {
          x: {
            ticks: {
              color: '#81d4fa',
              maxRotation: 45
            },
            grid: {
              color: 'rgba(129, 212, 250, 0.1)'
            }
          },
          y: {
            beginAtZero: true,
            ticks: {
              color: '#81d4fa'
            },
            grid: {
              color: 'rgba(129, 212, 250, 0.1)'
            }
          }
        }
      }
    });
  } catch (error) {
    console.error('Error creating category performance chart:', error);
  }
}

function createEngagementMetricsChart() {
  const canvas = document.getElementById('engagementMetricsChart');
  if (!canvas || typeof Chart === 'undefined') return;

  const ctx = canvas.getContext('2d');
  
  try {
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: appData.creators.map(creator => creator.name),
        datasets: [{
          label: 'Engagement Rate (%)',
          data: appData.creators.map(creator => creator.engagement),
          backgroundColor: chartColors[0],
          borderColor: chartColors[0],
          borderWidth: 2,
          borderRadius: 8,
          yAxisID: 'y'
        }, {
          label: 'Followers (K)',
          data: appData.creators.map(creator => creator.followers / 1000),
          backgroundColor: chartColors[1],
          borderColor: chartColors[1],
          borderWidth: 2,
          borderRadius: 8,
          yAxisID: 'y1'
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            labels: {
              color: '#ffffff'
            }
          }
        },
        scales: {
          x: {
            ticks: {
              color: '#81d4fa',
              maxRotation: 45
            },
            grid: {
              color: 'rgba(129, 212, 250, 0.1)'
            }
          },
          y: {
            type: 'linear',
            display: true,
            position: 'left',
            beginAtZero: true,
            ticks: {
              color: '#81d4fa'
            },
            grid: {
              color: 'rgba(129, 212, 250, 0.1)'
            }
          },
          y1: {
            type: 'linear',
            display: true,
            position: 'right',
            beginAtZero: true,
            ticks: {
              color: '#81d4fa'
            },
            grid: {
              drawOnChartArea: false
            }
          }
        }
      }
    });
  } catch (error) {
    console.error('Error creating engagement metrics chart:', error);
  }
}

function setupEarningsCalculator() {
  const viewsInput = document.getElementById('viewsInput');
  const subscribersInput = document.getElementById('subscribersInput');
  
  if (viewsInput) viewsInput.value = 200000;
  if (subscribersInput) subscribersInput.value = 500;
  calculateEarnings();
}

function calculateEarnings() {
  const viewsInput = document.getElementById('viewsInput');
  const subscribersInput = document.getElementById('subscribersInput');
  const adRevenue = document.getElementById('adRevenue');
  const subRevenue = document.getElementById('subRevenue');
  const totalRevenue = document.getElementById('totalRevenue');
  
  if (!viewsInput || !subscribersInput || !adRevenue || !subRevenue || !totalRevenue) return;
  
  const views = parseInt(viewsInput.value) || 0;
  const subscribers = parseInt(subscribersInput.value) || 0;
  
  const adRev = (views * 0.0012);
  const subRev = (subscribers * 0.499);
  const total = adRev + subRev;
  
  adRevenue.textContent = `$${adRev.toFixed(0)}`;
  subRevenue.textContent = `$${subRev.toFixed(2)}`;
  totalRevenue.textContent = `~$${total.toFixed(0)}`;
}

function renderCategoryMatrix() {
  const matrix = document.getElementById('categoryMatrix');
  if (!matrix) return;
  
  const gridHTML = `
    <div class="matrix-grid">
      <div class="matrix-header">Creator</div>
      ${appData.categories.map(cat => `<div class="matrix-header">${cat}</div>`).join('')}
      ${appData.creators.map(creator => `
        <div class="matrix-creator">${creator.name}</div>
        ${appData.categories.map(cat => {
          const isActive = creator.categories.includes(cat);
          const postCount = isActive ? Math.floor(Math.random() * 25) + 5 : Math.floor(Math.random() * 3);
          let cellClass = 'matrix-cell--none';
          let cellContent = '0';
          
          if (postCount > 10) {
            cellClass = 'matrix-cell--active';
            cellContent = postCount;
          } else if (postCount > 0) {
            cellClass = 'matrix-cell--limited';
            cellContent = postCount;
          }
          
          return `<div class="matrix-cell ${cellClass}">${cellContent}</div>`;
        }).join('')}
      `).join('')}
    </div>
  `;
  
  matrix.innerHTML = gridHTML;

  const statsContainer = document.getElementById('categoryStats');
  if (!statsContainer) return;
  
  const categoryStats = appData.categories.map(category => {
    const activeCreators = appData.creators.filter(creator => 
      creator.categories.includes(category)
    ).length;
    const totalPosts = appData.creators.reduce((sum, creator) => 
      sum + (creator.categories.includes(category) ? Math.floor(Math.random() * 20) + 5 : 0), 0
    );
    
    return {
      category,
      activeCreators,
      totalPosts,
      coverage: Math.round((activeCreators / appData.creators.length) * 100)
    };
  });

  statsContainer.innerHTML = categoryStats.map(stat => `
    <div class="card glass-card">
      <div class="card__body">
        <h4>${stat.category}</h4>
        <div class="metric">
          <div class="metric__value gradient-text">${stat.activeCreators}</div>
          <div class="metric__label">Active Creators</div>
        </div>
        <div class="metric">
          <div class="metric__value gradient-text">${stat.totalPosts}</div>
          <div class="metric__label">Total Posts</div>
        </div>
        <div class="metric">
          <div class="metric__value gradient-text">${stat.coverage}%</div>
          <div class="metric__label">Coverage</div>
        </div>
      </div>
    </div>
  `).join('');
}

function renderLeaderboard(type = 'followers') {
  let sortedCreators;
  let valueFormatter;

  switch (type) {
    case 'earnings':
      sortedCreators = [...appData.creators].sort((a, b) => b.incentives.totalProjectedMonthly - a.incentives.totalProjectedMonthly);
      valueFormatter = (creator) => `$${creator.incentives.totalProjectedMonthly}/month`;
      break;
    case 'engagement':
      sortedCreators = [...appData.creators].sort((a, b) => b.engagement - a.engagement);
      valueFormatter = (creator) => `${creator.engagement}%`;
      break;
    case 'referrals':
      sortedCreators = [...appData.creators].sort((a, b) => b.referrals - a.referrals);
      valueFormatter = (creator) => `${creator.referrals} referrals`;
      break;
    default:
      sortedCreators = [...appData.creators].sort((a, b) => b.followers - a.followers);
      valueFormatter = (creator) => formatNumber(creator.followers);
  }

  const podium = document.getElementById('podium');
  if (podium) {
    const top3 = sortedCreators.slice(0, 3);
    
    podium.innerHTML = top3.map((creator, index) => `
      <div class="podium-place">
        <div class="podium-rank podium-rank--${index + 1}">${index + 1}</div>
        <div class="podium-name">${creator.name}</div>
        <div class="podium-value">${valueFormatter(creator)}</div>
      </div>
    `).join('');
  }

  const leaderboardList = document.getElementById('leaderboardList');
  if (leaderboardList) {
    leaderboardList.innerHTML = sortedCreators.map((creator, index) => `
      <div class="leaderboard-item">
        <div class="leaderboard-rank">#${index + 1}</div>
        <div class="creator-info">
          <div class="creator-avatar">
            ${getCreatorAvatar(creator)}
          </div>
          <div class="creator-details">
            <h4>${creator.name}</h4>
            <div class="creator-handle">${creator.handle}</div>
          </div>
        </div>
        <div class="leaderboard-info">
          <div class="leaderboard-value">${valueFormatter(creator)}</div>
        </div>
      </div>
    `).join('');
  }
}

function renderMissions() {
  const missionsGrid = document.getElementById('missionsGrid');
  if (!missionsGrid) return;
  
  missionsGrid.innerHTML = appData.missions.map(mission => `
    <div class="mission-card glass-card">
      <div class="mission-header">
        <div class="mission-difficulty difficulty-${mission.difficulty.toLowerCase()}">${mission.difficulty}</div>
      </div>
      <h3 class="mission-title">${mission.name}</h3>
      <p class="mission-description">${mission.description}</p>
      <div class="mission-reward">
        <span>üèÜ</span>
        <span>${mission.xp} XP</span>
      </div>
    </div>
  `).join('');
}

function filterCreators(searchTerm) {
  filteredCreators = appData.creators.filter(creator => 
    creator.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
    creator.handle.toLowerCase().includes(searchTerm.toLowerCase()) ||
    creator.categories.some(cat => cat.toLowerCase().includes(searchTerm.toLowerCase()))
  );
  renderCreatorsTable();
}

function viewCreatorDetails(creatorId) {
  const creator = appData.creators.find(c => c.id === creatorId);
  if (!creator) return;

  const modalTitle = document.getElementById('creatorModalTitle');
  const modalBody = document.getElementById('creatorModalBody');

  if (modalTitle) modalTitle.textContent = `${creator.name} Details`;
  
  if (modalBody) {
    modalBody.innerHTML = `
      <div class="creator-detail-grid">
        <div class="detail-section">
          <div style="text-align: center; margin-bottom: 16px;">
            <div class="creator-avatar" style="width: 100px; height: 100px; margin: 0 auto; font-size: 36px;">
              ${getCreatorAvatar(creator)}
            </div>
          </div>
          <h4>Basic Information</h4>
          <p><strong>Name:</strong> ${creator.name}</p>
          <p><strong>Handle:</strong> ${creator.handle}</p>
          <p><strong>Email:</strong> ${creator.email}</p>
          <p><strong>Level:</strong> ${creator.level}</p>
          <p><strong>XP:</strong> ${creator.xp}</p>
          <p><strong>Join Date:</strong> ${creator.onboardingDate}</p>
        </div>
        
        <div class="detail-section">
          <h4>Performance Metrics</h4>
          <p><strong>Followers:</strong> ${formatNumber(creator.followers)} (${creator.followerTrend})</p>
          <p><strong>Engagement Rate:</strong> ${creator.engagement}%</p>
          <p><strong>Total Posts:</strong> ${creator.posts}</p>
          <p><strong>Referrals:</strong> ${creator.referrals}</p>
        </div>
        
        <div class="detail-section">
          <h4>Incentive Tracking</h4>
          <p><strong>Early Launch Posts:</strong> ${creator.incentives.earlyLaunchPosts}</p>
          <p><strong>Early Launch Earnings:</strong> $${creator.incentives.earlyLaunchEarnings}</p>
          <p><strong>Referral Earnings:</strong> $${creator.incentives.referralEarnings}</p>
          <p><strong>Projected Monthly Revenue:</strong> $${creator.incentives.totalProjectedMonthly}</p>
        </div>
        
        <div class="detail-section">
          <h4>Categories & Badges</h4>
          <div class="categories-tags">
            ${creator.categories.map(cat => `<span class="category-tag">${cat}</span>`).join('')}
          </div>
          <div style="margin-top: 16px;">
            ${creator.badges.map(badge => `<span class="badge badge--success">${getBadgeIcon(badge)} ${badge}</span>`).join('')}
          </div>
        </div>
      </div>
    `;
  }

  openModal('creatorModal');
}

function getBadgeIcon(badge) {
  const badgeData = appData.badges.find(b => b.name === badge);
  return badgeData ? badgeData.icon : 'üèÜ';
}

function editCreator(creatorId) {
  const creator = appData.creators.find(c => c.id === creatorId);
  if (!creator) return;

  const elements = {
    'editCreatorId': creator.id,
    'editCreatorName': creator.name,
    'editCreatorHandle': creator.handle,
    'editCreatorEmail': creator.email,
    'editCreatorFollowers': creator.followers
  };

  Object.entries(elements).forEach(([id, value]) => {
    const element = document.getElementById(id);
    if (element) element.value = value;
  });

  populateEditCategoryCheckboxes(creator.categories);

  if (creator.profilePicture) {
    displayProfilePicture(creator.profilePicture, 'edit');
  } else {
    resetProfilePicture('edit');
  }

  openModal('editCreatorModal');
  setTimeout(() => setupProfilePictureUpload('edit'), 100);
}

function populateEditCategoryCheckboxes(selectedCategories = []) {
  const container = document.getElementById('editCategoryCheckboxes');
  if (!container) return;
  
  container.innerHTML = appData.categories.map(category => `
    <div class="checkbox-item">
      <input type="checkbox" id="edit-cat-${category}" name="categories" value="${category}" ${selectedCategories.includes(category) ? 'checked' : ''}>
      <label for="edit-cat-${category}">${category}</label>
    </div>
  `).join('');
}

function confirmDeleteCreator(creatorId) {
  const creator = appData.creators.find(c => c.id === creatorId);
  if (!creator) return;

  creatorToDelete = creatorId;
  
  const deleteCreatorName = document.getElementById('deleteCreatorName');
  if (deleteCreatorName) deleteCreatorName.textContent = creator.name;
  
  const deleteProfilePicture = document.getElementById('deleteProfilePicture');
  if (deleteProfilePicture) {
    deleteProfilePicture.innerHTML = `
      <div class="creator-avatar" style="width: 60px; height: 60px;">
        ${getCreatorAvatar(creator)}
      </div>
    `;
  }
  
  openModal('deleteCreatorModal');
}

function handleDeleteCreator() {
  if (!creatorToDelete) return;

  const index = appData.creators.findIndex(c => c.id === creatorToDelete);
  if (index > -1) {
    appData.creators.splice(index, 1);
  }

  filteredCreators = [...appData.creators];

  updateHeaderStats();
  renderCreatorsTable();
  renderCategoryMatrix();
  renderLeaderboard();

  closeModal('deleteCreatorModal');
  creatorToDelete = null;

  showToast('Creator deleted successfully!', 'success');
}

function handleEditCreator(e) {
  e.preventDefault();
  
  if (!validateForm(e.target)) {
    return;
  }
  
  const formData = new FormData(e.target);
  const creatorId = parseInt(formData.get('id'));
  const selectedCategories = Array.from(document.querySelectorAll('#editCategoryCheckboxes input[name="categories"]:checked'))
    .map(cb => cb.value);
  
  const profilePreview = document.getElementById('editProfilePreview');
  const profilePicture = profilePreview ? (profilePreview.dataset.imageSrc || '') : '';
  
  const creatorIndex = appData.creators.findIndex(c => c.id === creatorId);
  if (creatorIndex > -1) {
    const creator = appData.creators[creatorIndex];
    
    creator.name = formData.get('name');
    creator.handle = formData.get('handle');
    creator.email = formData.get('email');
    creator.followers = parseInt(formData.get('followers'));
    creator.categories = selectedCategories;
    creator.profilePicture = profilePicture;

    updateCreatorBadges(creator);
  }

  filteredCreators = [...appData.creators];
  
  updateHeaderStats();
  renderCreatorsTable();
  renderCategoryMatrix();
  renderLeaderboard();
  
  closeModal('editCreatorModal');
  e.target.reset();

  showToast('Creator updated successfully!', 'success');
}

function populateCategoryCheckboxes() {
  const container = document.getElementById('categoryCheckboxes');
  if (!container) return;
  
  container.innerHTML = appData.categories.map(category => `
    <div class="checkbox-item">
      <input type="checkbox" id="cat-${category}" name="categories" value="${category}">
      <label for="cat-${category}">${category}</label>
    </div>
  `).join('');
}

function handleAddCreator(e) {
  e.preventDefault();
  
  if (!validateForm(e.target)) {
    return;
  }
  
  const formData = new FormData(e.target);
  const selectedCategories = Array.from(document.querySelectorAll('#categoryCheckboxes input[name="categories"]:checked'))
    .map(cb => cb.value);
  
  const profilePreview = document.getElementById('addProfilePreview');
  const profilePicture = profilePreview ? (profilePreview.dataset.imageSrc || '') : '';
  
  const newCreator = {
    id: Math.max(...appData.creators.map(c => c.id)) + 1,
    name: formData.get('name'),
    handle: formData.get('handle'),
    email: formData.get('email'),
    followers: parseInt(formData.get('followers')),
    followerTrend: '+0%',
    categories: selectedCategories,
    profilePicture: profilePicture,
    badges: ['First Steps'],
    level: 'Creator',
    xp: 50,
    posts: 1,
    engagement: 5.0,
    referrals: 0,
    premiumCreator: true,
    onboardingDate: new Date().toISOString().split('T')[0],
    lastActive: new Date().toISOString().split('T')[0],
    incentives: {
      earlyLaunchPosts: 0,
      earlyLaunchEarnings: 0,
      referralCount: 0,
      referralEarnings: 0,
      projectedAdRevenue: 50,
      projectedSubRevenue: 25,
      totalProjectedMonthly: 75
    }
  };

  updateCreatorBadges(newCreator);

  appData.creators.push(newCreator);
  filteredCreators = [...appData.creators];
  
  updateHeaderStats();
  renderCreatorsTable();
  renderCategoryMatrix();
  renderLeaderboard();
  
  closeModal('addCreatorModal');
  e.target.reset();
  resetProfilePicture('add');

  showToast('Creator added successfully!', 'success');
}

function updateCreatorBadges(creator) {
  creator.badges = ['First Steps'];
  
  if (creator.categories.length >= 3) {
    creator.badges.push('Category Explorer');
  }
  
  if (creator.categories.length === 6) {
    creator.badges.push('News Master');
  }
  
  if (creator.followers >= 10000) {
    creator.badges.push('Rising Star');
  }
  
  if (creator.referrals >= 3) {
    creator.badges.push('Community Builder');
  }
  
  if (creator.engagement >= 10) {
    creator.badges.push('Engagement King');
  }

  if (creator.badges.length >= 4 || creator.xp >= 2000) {
    creator.level = 'News Master';
  } else if (creator.badges.length >= 2 || creator.xp >= 1000) {
    creator.level = 'Influencer';
  } else {
    creator.level = 'Creator';
  }
}

function validateForm(form) {
  const requiredFields = form.querySelectorAll('input[required]');
  let isValid = true;
  
  requiredFields.forEach(field => {
    if (!field.value.trim()) {
      field.style.borderColor = '#ff5252';
      isValid = false;
    } else {
      field.style.borderColor = '';
    }
  });

  const emailField = form.querySelector('input[type="email"]');
  if (emailField && emailField.value) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(emailField.value)) {
      emailField.style.borderColor = '#ff5252';
      showToast('Please enter a valid email address.', 'error');
      isValid = false;
    }
  }

  const handleField = form.querySelector('input[name="handle"]');
  if (handleField && handleField.value) {
    if (!handleField.value.startsWith('@')) {
      handleField.value = '@' + handleField.value.replace('@', '');
    }
  }

  if (!isValid) {
    showToast('Please fill in all required fields correctly.', 'error');
  }

  return isValid;
}

function openModal(modalId) {
  const modal = document.getElementById(modalId);
  if (modal) {
    modal.classList.add('modal--active');
    document.body.style.overflow = 'hidden';
  }
}

function closeModal(modalId) {
  const modal = document.getElementById(modalId);
  if (modal) {
    modal.classList.remove('modal--active');
    document.body.style.overflow = 'auto';
  }
}

function formatNumber(num) {
  if (num >= 1000000) {
    return (num / 1000000).toFixed(1) + 'M';
  } else if (num >= 1000) {
    return (num / 1000).toFixed(1) + 'K';
  }
  return num.toString();
}

function showToast(message, type = 'info') {
  const toast = document.createElement('div');
  toast.className = `toast toast--${type}`;
  toast.innerHTML = `
    <div class="toast__content">
      <span class="toast__icon">${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è'}</span>
      <span class="toast__message">${message}</span>
    </div>
  `;

  toast.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(26, 35, 50, 0.9);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(129, 212, 250, 0.2);
    border-radius: 12px;
    padding: 16px;
    color: white;
    z-index: 10000;
    opacity: 0;
    transform: translateX(100px);
    transition: all 0.3s ease;
    box-shadow: 0 8px 32px rgba(33, 150, 243, 0.1);
  `;

  document.body.appendChild(toast);

  setTimeout(() => {
    toast.style.opacity = '1';
    toast.style.transform = 'translateX(0)';
  }, 100);

  setTimeout(() => {
    toast.style.opacity = '0';
    toast.style.transform = 'translateX(100px)';
    setTimeout(() => {
      if (document.body.contains(toast)) {
        document.body.removeChild(toast);
      }
    }, 300);
  }, 3000);
}